<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
	<title>Hackok</title>

	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="Webestica.com">
	<meta name="description" content="Booking - Multipurpose Online Booking Theme">

	<!--&lt;!&ndash; Dark mode &ndash;&gt;
	<script>
		const storedTheme = localStorage.getItem('theme')

		const getPreferredTheme = () => {
			if (storedTheme) {
				return storedTheme
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
		}

		const setTheme = function (theme) {
			if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
				document.documentElement.setAttribute('data-bs-theme', 'dark')
			} else {
				document.documentElement.setAttribute('data-bs-theme', theme)
			}
		}

		setTheme(getPreferredTheme())

		window.addEventListener('DOMContentLoaded', () => {
			var el = document.querySelector('.theme-icon-active');
			if(el != 'undefined' && el != null) {
				const showActiveTheme = theme => {
					const activeThemeIcon = document.querySelector('.theme-icon-active use')
					const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
					const svgOfActiveBtn = btnToActive.querySelector('.mode-switch use').getAttribute('href')

					document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
						element.classList.remove('active')
					})

					btnToActive.classList.add('active')
					activeThemeIcon.setAttribute('href', svgOfActiveBtn)
				}

				window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
					if (storedTheme !== 'light' || storedTheme !== 'dark') {
						setTheme(getPreferredTheme())
					}
				})

				showActiveTheme(getPreferredTheme())

				document.querySelectorAll('[data-bs-theme-value]')
						.forEach(toggle => {
							toggle.addEventListener('click', () => {
								const theme = toggle.getAttribute('data-bs-theme-value')
								localStorage.setItem('theme', theme)
								setTheme(theme)
								showActiveTheme(theme)
							})
						})

			}
		})

	</script>-->

	<!-- Favicon -->
	<link rel="shortcut icon" href="../../assets/images/favicon.ico">

	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap">

	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" href="../assets/vendor/font-awesome/css/all.min.css">
	<link rel="stylesheet" type="text/css" href="../assets/vendor/bootstrap-icons/bootstrap-icons.css">
	<link rel="stylesheet" type="text/css" href="../assets/vendor/aos/aos.css">
	<link rel="stylesheet" type="text/css" href="../assets/vendor/flatpickr/css/flatpickr.min.css">
	<link rel="stylesheet" type="text/css" href="../assets/vendor/choices/css/choices.min.css">

	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" href="../assets/css/style.css">

</head>

<body class="dashboard">

<!-- Header START -->
<header class="navbar-light header-sticky">
	<!-- Logo Nav START -->
	<nav class="navbar navbar-expand-xl">
		<div class="container">
			<!-- Logo START -->
			<a class="navbar-brand" href="/">
				<img class="light-mode-item navbar-brand-item" src="../assets/images/logo.svg" alt="logo">
				<img class="dark-mode-item navbar-brand-item" src="../assets/images/logo-light.svg" alt="logo">
			</a>
			<!-- Logo END -->

			<!-- Buttons START -->
			<ul class="nav flex-row align-items-center list-unstyled ms-xl-auto">

				<!-- Download app -->
				<li class="nav-item align-items-center d-none d-sm-flex position-relative me-sm-3">
					<!-- Icon -->
					<a href="#" class="icon-md btn btn-light mb-0 p-0 flex-shrink-0"><i class="bi bi-cloud-download-fill"></i></a>
					<div class="ms-2 d-none d-md-block">
						<h6 class="mb-0"><a href="#" class="stretched-link korean-font-bold">앱 다운로드</a></h6>
						<p class="small mb-0 text-body korean-font-bold">어플리케이션을 설치하여 더 나은 경험을 해보세요</p>
					</div>
				</li>
				<!-- Login button START -->
				<li class="nav-item ms-3">
					<form action="/logout" method="post">
						<button class="btn btn-sm btn-primary mb-0 korean-font-bold"><i class="fa-solid fa-right-to-bracket me-2"></i>로그아웃</button>
					</form>
				</li>
				<!-- Login button END -->
			</ul>
			<!-- Buttons START -->

		</div>
	</nav>
	<!-- Logo Nav END -->
</header>
<!-- Header END -->

<!-- **************** MAIN CONTENT START **************** -->
<main>

	<!-- =======================
    Content START -->
	<section class="pt-3">
		<div class="container">
			<div class="row">

				<!-- Sidebar START -->
				<div class="col-lg-4 col-xl-3">
					<!-- Responsive offcanvas body START -->
					<div class="offcanvas-lg offcanvas-end" tabindex="-1" id="offcanvasSidebar" >
						<!-- Offcanvas header -->
						<div class="offcanvas-header justify-content-end pb-2">
							<button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasSidebar" aria-label="Close"></button>
						</div>

						<!-- Offcanvas body -->
						<div class="offcanvas-body p-3 p-lg-0">
							<div class="card bg-light w-100">

								<!-- Card body START -->
								<div class="card-body p-3">
									<!-- Avatar and content -->
									<div class="text-center mb-3">
										<h6 class="mb-0 korean-font-bold" th:text="${member.name}">회원 이름</h6>
										<a href="#" class="text-reset text-primary-hover small korean-font-bold" th:text="${member.loginId}">회원 아이디</a>
										<hr>
									</div>

									<!-- Sidebar menu item START -->
									<ul class="nav nav-pills-primary-soft flex-column">
										<li class="nav-item">
											<a class="nav-link korean-font-bold" href="/mypage"><i class="bi bi-person fa-fw me-2"></i>내 정보</a>
										</li>
										<li class="nav-item">
											<a class="nav-link korean-font-bold" href="/changeInfoForm"><i class="bi bi-gear fa-fw me-2"></i>회원정보 변경</a>
										</li>
										<li class="nav-item">
											<a class="nav-link korean-font-bold active" href="/changePasswordForm"><i class="bi bi-key fa-fw me-2"></i>비밀번호 변경</a>
										</li>
										<li class="nav-item">
											<a id="deleteaccount-btn" class="nav-link text-danger bg-danger-soft-hover korean-font-bold" href="#"><i class="fas fa-sign-out-alt fa-fw me-2"></i>회원 탈퇴</a>
										</li>
									</ul>

									<!-- Sidebar menu item END -->
								</div>
								<!-- Card body END -->
							</div>
						</div>
					</div>
					<!-- Responsive offcanvas body END -->
				</div>
				<!-- Sidebar END -->

				<!-- Main content START -->
				<div class="col-lg-8 col-xl-9">

					<!-- Offcanvas menu button -->
					<div class="d-grid mb-0 d-lg-none w-100">
						<button class="btn btn-primary mb-4 korean-font-bold" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
							<i class="fas fa-sliders-h"></i> 메뉴
						</button>
					</div>

					<div class="vstack gap-4">
						<!-- Personal info START -->
						<!-- Update Password START -->
						<div class="card border">
							<!-- Card header -->
							<div class="card-header border-bottom">
								<h4 class="card-header-title korean-font-bold">비밀번호 변경</h4>
							</div>

							<!-- Card body START -->
							<form class="card-body" action="/changePassword" method="post" id="main-form">
								<!-- Current password -->
								<div class="mb-3">
									<label class="form-label korean-font-bold">현재 비밀번호</label>
									<input class="form-control korean-font" type="password" placeholder="현재 비밀번호를 입력하세요" name="oldPassword" id="oldPassword">
								</div>
								<!-- New password -->
								<div class="mb-3">
									<label class="form-label korean-font-bold"> 새 비밀번호</label>
									<div class="input-group">
										<input class="form-control fakepassword korean-font" placeholder="새 비밀번호를 입력하세요" type="password" id="new-psw-input" name="newPassword">
										<span class="input-group-text p-0 bg-transparent">
										<i class="fakepasswordicon fas fa-eye-slash cursor-pointer p-2"></i>
									</span>
									</div>
								</div>
								<!-- Confirm -->
								<div class="mb-3">
									<label class="form-label korean-font-bold">새 비밀번호 확인</label>
									<input class="form-control korean-font" type="password" placeholder="새 비밀번호를 다시 한번 입력하세요" id="new-psw-input-confirm">
								</div>

								<div class="text-end">
									<button class="btn btn-primary mb-0 korean-font-bold" id="submit-btn">비밀번호 변경</button>
								</div>
							</form>
							<!-- Card body END -->
						</div>
						<!-- Update Password END -->
					</div>
				</div>
				<!-- Main content END -->
			</div>
		</div>
	</section>
	<!-- =======================
    Content END -->
	<section style="padding: 30px 0px 30px 0px;">
		<!-- Navbar mobile START -->
		<div class="navbar navbar-mobile">
			<ul class="navbar-nav">
				<!-- Nav item 최근기록 -->
				<li class="nav-item">
					<a class="nav-link" href="/list" id="left-nav-item"><i class="bi bi-bookmark fa-fw"></i>
						<span class="mb-0 nav-text korean-font-bold">최근 기록</span>
					</a>
				</li>

				<!-- Nav item 홈 -->
				<li class="nav-item">
					<a class="nav-link" href="/" ><i class="bi bi-house-door fa-fw"></i>
						<span class="mb-0 nav-text korean-font-bold">홈</span>
					</a>
				</li>

				<!-- Nav item 내 계정 -->
				<li class="nav-item">
					<a class="nav-link active" href="/mypage" id="right-nav-item"><i class="bi bi-person-circle fa-fw"></i>
						<span class="mb-0 nav-text korean-font-bold">내 계정</span>
					</a>
				</li>
			</ul>
		</div>
		<!-- Navbar mobile END -->
	</section>
</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- Back to top -->
<div class="back-top"></div>

<!-- Bootstrap JS -->
<script src="../assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<!-- Vendors -->
<script src="../assets/vendor/aos/aos.js"></script>
<script src="../assets/vendor/flatpickr/js/flatpickr.min.js"></script>
<script src="../assets/vendor/choices/js/choices.min.js"></script>

<!-- ThemeFunctions -->
<script src="../assets/js/functions.js"></script>

</body>
</html><script>
	// (function() {
	// 	var ws = new WebSocket('ws://' + window.location.host +
	// 			'/jb-server-page?reloadMode=RELOAD_ON_SAVE&'+
	// 			'referrer=' + encodeURIComponent(window.location.pathname));
	// 	ws.onmessage = function (msg) {
	// 		if (msg.data === 'reload') {
	// 			window.location.reload();
	// 		}
	// 		if (msg.data.startsWith('update-css ')) {
	// 			var messageId = msg.data.substring(11);
	// 			var links = document.getElementsByTagName('link');
	// 			for (var i = 0; i < links.length; i++) {
	// 				var link = links[i];
	// 				if (link.rel !== 'stylesheet') continue;
	// 				var clonedLink = link.cloneNode(true);
	// 				var newHref = link.href.replace(/(&|\?)jbUpdateLinksId=\d+/, "$1jbUpdateLinksId=" + messageId);
	// 				if (newHref !== link.href) {
	// 					clonedLink.href = newHref;
	// 				}
	// 				else {
	// 					var indexOfQuest = newHref.indexOf('?');
	// 					if (indexOfQuest >= 0) {
	// 						// to support ?foo#hash
	// 						clonedLink.href = newHref.substring(0, indexOfQuest + 1) + 'jbUpdateLinksId=' + messageId + '&' +
	// 								newHref.substring(indexOfQuest + 1);
	// 					}
	// 					else {
	// 						clonedLink.href += '?' + 'jbUpdateLinksId=' + messageId;
	// 					}
	// 				}
	// 				link.replaceWith(clonedLink);
	// 			}
	// 		}
	// 	};
	// })();

	// 회원 탈퇴
	document.getElementById("deleteaccount-btn").addEventListener("click", function(event) {
		event.preventDefault();

		var confirmation = confirm("회원 탈퇴를 진행하시겠습니까?");

		if (confirmation) {
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "/myPage/deleteaccount", true);
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.onreadystatechange = function() {
				if (xhr.readyState === XMLHttpRequest.DONE) {
					if (xhr.status === 200) {
						window.location.href = "/login"; // Replace with your desired redirect URL
					} else {
						// Handle error response
						console.error("회원 탈퇴 요청 중 오류 발생");
					}
				}
			};
			xhr.send();
		} else {
			console.log("회원 탈퇴 요청이 취소되었습니다.");
		}
	});

	function confirmNewPassword() {
		const form = document.getElementById("main-form"); // id가 main-form인 form 요소를 가져옴
		const newPasswordInput = document.getElementById("new-psw-input");
		const confirmPasswordInput = document.getElementById("new-psw-input-confirm");
		if (newPasswordInput.value !== confirmPasswordInput.value) {
			alert("새 비밀번호가 일치하지 않습니다."); // 오류 메시지 표시
		} else {
			form.submit(); // 폼 제출
		}
	}

	// 새 비밀번호 확인 체크
	document.getElementById("submit-btn").addEventListener("click", function(event) {
		event.preventDefault();
		const oldPassword = document.getElementById("oldPassword");
		console.log("password 값은: "+oldPassword.value);
		console.log(typeof (oldPassword.value));
		fetch("/confirmPassword", {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify({
				oldPassword : oldPassword.value+""
			}),
		})
				.then(response => response.json())
				.then(data => {
					// 서버에서 받은 응답 처리
					if (data === 1) {
						confirmNewPassword();
					} else {
						alert("현재 비밀번호가 틀립니다.");
					}
				})
				.catch(error => {
					console.error('Error:', error);
				});
	});
</script>